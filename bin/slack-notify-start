#!/bin/bash
# Hook wrapper for UserPromptSubmit - starts timing a task
# Extracts session_id from stdin JSON (provided by Claude Code hooks) to use as instance ID

STDIN_DATA=$(cat)

# Try jq first, fall back to grep/sed if not available
if command -v jq &>/dev/null; then
    SESSION_ID=$(echo "$STDIN_DATA" | jq -r '.session_id // empty' 2>/dev/null)
else
    # Fallback: extract session_id using grep/sed (works for simple JSON)
    SESSION_ID=$(echo "$STDIN_DATA" | grep -o '"session_id":"[^"]*"' | sed 's/"session_id":"//;s/"$//' 2>/dev/null)
fi

if [[ -n "$SESSION_ID" ]]; then
    CLAUDE_INSTANCE_ID="$SESSION_ID" exec "$HOME/.claude/bin/claude-slack-notify" start
else
    # Fallback to PPID if no session_id (shouldn't happen with properly configured hooks)
    exec "$HOME/.claude/bin/claude-slack-notify" start
fi
